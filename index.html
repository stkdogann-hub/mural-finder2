<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mural Finder - Opportunity Planner</title>
    <!-- Google Fonts for modern typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary-color: #2563eb;
            --primary-hover: #1d4ed8;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --neutral-color: #6b7280;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.5;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 2rem;
        }

        /* Header */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem 0;
            background-color: var(--card-bg);
            padding: 1rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            font-size: 1.5rem;
            color: var(--danger-color);
        }

        .logo-area h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            margin-right: 1rem;
            cursor: pointer;
        }

        /* Buttons */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            font-weight: 500;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        .btn-primary:disabled {
            background-color: var(--text-secondary);
            cursor: not-allowed;
        }

        .btn-secondary {
            background-color: white;
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background-color: #f9fafb;
        }

        .btn-icon {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--text-secondary);
            padding: 0.25rem;
        }

        .btn-icon:hover {
            color: var(--text-primary);
        }

        .full-width {
            width: 100%;
        }

        /* Stats Dashboard */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border-left: 4px solid transparent;
            position: relative;
        }

        .stat-card:nth-child(1) {
            border-left-color: var(--neutral-color);
        }

        .stat-card:nth-child(2) {
            border-left-color: var(--success-color);
        }

        .stat-card:nth-child(3) {
            border-left-color: var(--warning-color);
        }

        .stat-card:nth-child(4) {
            border-left-color: var(--neutral-color);
        }

        .stat-card.overdue {
            border-left-color: var(--danger-color);
        }

        .stat-header {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
        }

        /* Recommendations Banner */
        .recommendations-banner {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
        }

        .banner-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .banner-header h3 {
            font-weight: 600;
        }

        .banner-content p {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        /* Main Content */
        .main-content {
            background-color: var(--card-bg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            padding: 1.5rem;
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .search-bar {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border: 1px solid var(--border-color);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            width: 300px;
        }

        .search-bar input {
            border: none;
            outline: none;
            width: 100%;
            font-size: 0.9rem;
        }

        .filters {
            display: flex;
            gap: 1rem;
        }

        .filters select {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background-color: white;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        /* Table */
        .mural-table {
            width: 100%;
            border-collapse: collapse;
        }

        .mural-table th {
            text-align: left;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .mural-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.95rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow-md);
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .upload-area {
            border: 2px dashed var(--border-color);
            padding: 3rem;
            text-align: center;
            border-radius: var(--radius-lg);
            margin: 1.5rem 0;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
        }

        .upload-area i {
            font-size: 3rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .preview-area {
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .preview-area img {
            max-width: 100%;
            max-height: 200px;
            border-radius: var(--radius-md);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
        }

        .help-text {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        /* Status Badges */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-good {
            background-color: #d1fae5;
            color: #065f46;
        }

        .status-review {
            background-color: #fef3c7;
            color: #92400e;
        }

        /* Status Select Dropdown */
        .status-select {
            padding: 0.4rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .status-pending {
            background-color: #fef3c7;
            color: #92400e;
        }

        .status-applied {
            background-color: #d1fae5;
            color: #065f46;
        }

        .status-missed {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .status-won {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #78350f;
            font-weight: 700;
            animation: trophy-glow 2s ease-in-out infinite;
        }

        @keyframes trophy-glow {

            0%,
            100% {
                box-shadow: 0 0 5px rgba(251, 191, 36, 0.5);
            }

            50% {
                box-shadow: 0 0 15px rgba(251, 191, 36, 0.8);
            }
        }

        /* Urgency Indicators */
        @keyframes pulse-urgent {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }

            50% {
                box-shadow: 0 0 0 8px rgba(239, 68, 68, 0);
            }
        }

        @keyframes pulse-warning {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.5);
            }

            50% {
                box-shadow: 0 0 0 6px rgba(245, 158, 11, 0);
            }
        }

        .row-urgent {
            background: linear-gradient(90deg, #fef2f2 0%, #fff 100%) !important;
            border-left: 4px solid #ef4444 !important;
        }

        .row-warning {
            background: linear-gradient(90deg, #fffbeb 0%, #fff 100%) !important;
            border-left: 4px solid #f59e0b !important;
        }

        .urgency-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            animation: pulse-urgent 2s infinite;
        }

        .urgency-badge.urgent {
            background: #fee2e2;
            color: #dc2626;
        }

        .urgency-badge.warning {
            background: #fef3c7;
            color: #d97706;
            animation: pulse-warning 2s infinite;
        }

        .urgency-badge.safe {
            background: #d1fae5;
            color: #059669;
            animation: none;
        }

        .deadline-cell {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        /* Slot Machine Budget Animation */
        .budget-card {
            position: relative;
            overflow: hidden;
        }

        .budget-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {

            0%,
            100% {
                transform: translateX(-100%) rotate(45deg);
            }

            50% {
                transform: translateX(100%) rotate(45deg);
            }
        }

        .budget-value {
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
        }

        .budget-value.spinning {
            animation: slotSpin 0.1s ease-in-out;
        }

        @keyframes slotSpin {
            0% {
                transform: translateY(-3px);
                opacity: 0.7;
            }

            50% {
                transform: translateY(3px);
                opacity: 0.9;
            }

            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .budget-value.jackpot {
            animation: jackpot 0.5s ease-out;
        }

        @keyframes jackpot {
            0% {
                transform: scale(1);
            }

            25% {
                transform: scale(1.2);
                text-shadow: 0 0 20px rgba(255, 255, 0, 0.8);
            }

            50% {
                transform: scale(1.1);
            }

            75% {
                transform: scale(1.15);
                text-shadow: 0 0 30px rgba(255, 255, 0, 1);
            }

            100% {
                transform: scale(1);
                text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            }
        }

        /* Favorite row styling */
        .row-favorite {
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 182, 193, 0.1) 100%) !important;
            border: 2px solid #ffd700 !important;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .favorite-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            transition: transform 0.2s, color 0.2s;
            padding: 4px;
        }

        .favorite-btn:hover {
            transform: scale(1.2);
        }

        .favorite-btn.active {
            color: #ef4444;
            animation: heartBeat 0.6s ease-in-out;
        }

        @keyframes heartBeat {

            0%,
            100% {
                transform: scale(1);
            }

            25% {
                transform: scale(1.3);
            }

            50% {
                transform: scale(1);
            }

            75% {
                transform: scale(1.2);
            }
        }

        .sparkle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #ffd700 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            animation: sparkle 0.8s ease-out forwards;
        }

        @keyframes sparkle {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: scale(2) rotate(180deg);
                opacity: 0;
            }
        }

        /* Budget Fire Animation */
        .budget-fire {
            background: linear-gradient(180deg, #ff6b00, #ff9500, #ffcc00, #ff9500, #ff6b00);
            background-size: 100% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: fireFlicker 0.8s ease-in-out infinite alternate;
            text-shadow: 0 0 10px rgba(255, 107, 0, 0.5);
            filter: drop-shadow(0 0 8px rgba(255, 150, 0, 0.6));
        }

        @keyframes fireFlicker {
            0% {
                background-position: 0% 0%;
                filter: drop-shadow(0 0 5px rgba(255, 107, 0, 0.4));
            }

            50% {
                filter: drop-shadow(0 0 12px rgba(255, 150, 0, 0.8));
            }

            100% {
                background-position: 0% 100%;
                filter: drop-shadow(0 0 8px rgba(255, 200, 0, 0.6));
            }
        }

        /* Budget size and color classes */
        .budget-gray {
            font-size: 0.9rem;
            color: #4b5563 !important;
            -webkit-text-fill-color: #4b5563 !important;
        }

        .budget-purple {
            font-size: 1.1rem;
            font-weight: 600;
            color: #7c3aed !important;
            -webkit-text-fill-color: #7c3aed !important;
            text-shadow: 0 0 8px rgba(124, 58, 237, 0.3);
        }

        .budget-orange {
            font-size: 1.3rem;
            font-weight: 700;
            color: #f97316 !important;
            -webkit-text-fill-color: #f97316 !important;
            text-shadow: 0 0 10px rgba(249, 115, 22, 0.4);
        }

        .budget-green {
            font-size: 1.5rem;
            font-weight: 800;
            color: #10b981 !important;
            -webkit-text-fill-color: #10b981 !important;
            text-shadow: 0 0 12px rgba(16, 185, 129, 0.5);
        }

        .budget-red {
            font-size: 1.8rem;
            font-weight: 900;
            letter-spacing: 0.5px;
            color: #ef4444 !important;
            -webkit-text-fill-color: #ef4444 !important;
            text-shadow: 0 0 15px rgba(239, 68, 68, 0.6);
            animation: budgetPulse 1.5s ease-in-out infinite;
        }

        @keyframes budgetPulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.03);
            }
        }

        /* View Toggle Switch */
        .view-toggle-container {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            position: relative;
            z-index: 10;
        }

        .view-toggle {
            position: relative;
            display: flex;
            background: #f3f4f6;
            border-radius: 40px;
            padding: 6px;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.08);
            border: 1px solid #e5e7eb;
        }

        .toggle-btn {
            position: relative;
            z-index: 2;
            padding: 12px 40px;
            border: none;
            background: transparent;
            color: #6b7280;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: color 0.3s ease;
            border-radius: 35px;
            display: flex;
            align-items: center;
            gap: 10px;
            outline: none;
        }

        .toggle-btn:hover {
            color: #4b5563;
        }

        .toggle-btn.active {
            color: #fff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .toggle-slider {
            position: absolute;
            top: 6px;
            left: 6px;
            height: calc(100% - 12px);
            width: calc(50% - 6px);
            background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
            border-radius: 35px;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
        }

        /* Budget Edit */
        .budget-cell {
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .budget-cell:hover {
            background-color: #f3f4f6;
        }

        .budget-cell:hover::after {
            content: '‚úé';
            position: absolute;
            right: -15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
            color: #9ca3af;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo-area">
                <i class="fa-solid fa-bullseye logo-icon"></i>
                <h1>Mural Opportunities</h1>
            </div>

            <div class="header-actions">
                <div id="won-prize-display"
                    style="display: none; align-items: center; gap: 8px; margin-right: 1rem; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); padding: 6px 12px; border-radius: 20px; color: #78350f; font-weight: 700; box-shadow: 0 2px 10px rgba(245, 158, 11, 0.3); animation: trophy-glow 2s infinite;">
                    <i class="fa-solid fa-trophy"></i>
                    <span id="won-prize-amount">$0</span>
                </div>
                <div class="user-profile">
                    <span>User 1</span>
                    <i class="fa-solid fa-chevron-down"></i>
                </div>
                <button id="add-opportunity-btn" class="btn btn-primary">
                    <i class="fa-solid fa-plus"></i> Add Opportunity
                </button>
                <div id="paste-link-container" style="display: inline-flex; align-items: center; gap: 6px;">
                    <button id="paste-link-btn" class="btn btn-secondary">
                        <i class="fa-solid fa-link"></i> Paste Link
                    </button>
                    <div id="paste-link-input-area" style="display: none; align-items: center; gap: 6px;">
                        <input type="text" id="paste-link-input" placeholder="URL yapƒ±≈ütƒ±r..."
                            style="width: 200px; padding: 8px 12px; border: 2px solid #4f46e5; border-radius: 8px; font-size: 0.9rem; outline: none;">
                        <button id="paste-link-analyze"
                            style="background: #10b981; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            <i class="fa-solid fa-search"></i> Analiz Et
                        </button>
                        <button id="paste-link-cancel"
                            style="background: #ef4444; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer;">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>
                </div>
                <button id="settings-btn" class="btn btn-icon" title="Settings">
                    <i class="fa-solid fa-gear"></i>
                </button>
            </div>
        </header>

        <!-- API Key Modal -->
        <div id="settings-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2>Settings</h2>

                <!-- API Info -->
                <div
                    style="background: linear-gradient(135deg, #4285f4 0%, #34a853 50%, #fbbc04 100%); padding: 12px 16px; border-radius: 10px; margin-bottom: 1rem; color: white;">
                    <div style="font-weight: 700; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 1.3rem;">‚ú®</span> Google Gemini API
                    </div>
                    <div style="font-size: 0.8rem; opacity: 0.9; margin-top: 4px;">Model: gemini-2.5-flash</div>
                </div>

                <div class="form-group">
                    <label for="api-key-input">API Key:</label>
                    <input type="password" id="api-key-input" placeholder="Enter your Gemini API Key">
                    <p class="help-text">Resim, PDF ve web link analizi i√ßin kullanƒ±lƒ±r.</p>
                </div>
                <button id="save-api-key" class="btn btn-primary">Save</button>
            </div>
        </div>

        <!-- Dashboard Stats -->
        <section class="dashboard-stats">
            <div class="stat-card budget-card"
                style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                <div class="stat-header" style="color: rgba(255,255,255,0.9);">üí∞ TOPLAM B√úT√áE</div>
                <div class="stat-value budget-value" id="stat-budget"
                    style="font-size: 2rem; text-shadow: 0 2px 10px rgba(0,0,0,0.3);">$0</div>
                <div class="stat-indicator" style="background: rgba(255,255,255,0.3);"></div>
            </div>
            <div class="stat-card">
                <div class="stat-header">TOTAL OPPORTUNITIES</div>
                <div class="stat-value" id="stat-total">0</div>
                <div class="stat-indicator active"></div>
            </div>
            <div class="stat-card">
                <div class="stat-header">APPLIED</div>
                <div class="stat-value" id="stat-applied">0</div>
                <div class="stat-indicator success"></div>
            </div>
            <div class="stat-card">
                <div class="stat-header">UPCOMING DEADLINES</div>
                <div class="stat-value" id="stat-upcoming">0</div>
                <div class="stat-indicator warning"></div>
            </div>
            <div class="stat-card overdue">
                <div class="stat-header">MISSED</div>
                <div class="stat-value" id="stat-missed">0</div>
                <div class="stat-indicator danger"></div>
            </div>
        </section>

        <!-- Recommendations Banner -->
        <div class="recommendations-banner">
            <div class="banner-header">
                <i class="fa-regular fa-lightbulb"></i>
                <h3>Analysis Insights</h3>
            </div>
            <div class="banner-content">
                <p id="insight-text">Upload a mural opportunity flyer or document to extract competition details.</p>
            </div>
        </div>

        <!-- Main Content Area -->
        <main class="main-content">
            <div class="toolbar">
                <div class="search-bar">
                    <i class="fa-solid fa-search"></i>
                    <input type="text" placeholder="Search murals...">
                </div>
                <div class="filters">
                    <select>
                        <option>All Regions</option>
                    </select>
                </div>
            </div>

            <!-- Tabs and Sort -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <!-- View Toggle -->
                <div class="view-toggle-container">
                    <div class="view-toggle">
                        <button id="tab-active" class="toggle-btn active" onclick="setView('active')">
                            <i class="fa-solid fa-clipboard-list"></i> Aktif
                        </button>
                        <button id="tab-archive" class="toggle-btn" onclick="setView('archive')">
                            <i class="fa-solid fa-box-archive"></i> Ar≈üiv
                        </button>
                        <div class="toggle-slider"></div>
                    </div>
                </div>

                <!-- Sort and Filter Bar -->
                <div style="display: flex; justify-content: flex-end; align-items: center; margin-bottom: 1rem;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="color: #666; font-size: 0.9rem;">Sƒ±rala:</span>
                        <select id="sort-select" onchange="handleSort(this.value)"
                            style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem;">
                            <option value="deadline">üìÖ Tarih (Yakƒ±n)</option>
                            <option value="budget">üí∞ B√ºt√ße (Y√ºksek)</option>
                            <option value="name">üî§ ƒ∞sim (A-Z)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Mural List -->
            <div class="mural-list-container">
                <table class="mural-table">
                    <thead>
                        <tr>
                            <th style="width: 60px;">Image</th>
                            <th>Location</th>
                            <th>Competition Name</th>
                            <th>Budget</th>
                            <th>Deadline</th>
                            <th>Apply Link</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="mural-list-body">
                        <!-- Dynamic Content Here -->
                    </tbody>
                </table>
                <div id="empty-state" class="empty-state">
                    <p>No opportunities found. Click "+ Add Opportunity" to upload.</p>
                </div>
            </div>
        </main>

        <!-- Upload Modal -->
        <div id="upload-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2>Upload Opportunity Document</h2>
                <div class="upload-area" id="drop-zone">
                    <i class="fa-solid fa-cloud-arrow-up"></i>
                    <p>Drag & Drop files here</p>
                    <p>or</p>
                    <label for="file-upload" class="btn btn-primary">Browse Files</label>
                    <input type="file" id="file-upload" accept="*/*" multiple hidden>
                </div>
                <div id="preview-area" class="preview-area hidden"></div>
                <button id="analyze-btn" class="btn btn-primary full-width" disabled>
                    <i class="fa-solid fa-wand-magic-sparkles"></i> Analyze with Gemini
                </button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const addBtn = document.getElementById('add-opportunity-btn');
        const settingsBtn = document.getElementById('settings-btn');
        const uploadModal = document.getElementById('upload-modal');
        const settingsModal = document.getElementById('settings-modal');
        const closeButtons = document.querySelectorAll('.close-modal');
        const fileInput = document.getElementById('file-upload');
        const dropZone = document.getElementById('drop-zone');
        const previewArea = document.getElementById('preview-area');
        const analyzeBtn = document.getElementById('analyze-btn');
        const apiKeyInput = document.getElementById('api-key-input');
        const saveApiKeyBtn = document.getElementById('save-api-key');
        const muralListBody = document.getElementById('mural-list-body');
        const emptyState = document.getElementById('empty-state');
        const insightText = document.getElementById('insight-text');
        const pasteLinkBtn = document.getElementById('paste-link-btn');

        // Pre-loaded data for GitHub Pages (when localStorage is empty)
        const preloadedData = [{"id":1770616792011,"state":"Dothan, AL","competitionName":"CALL TO MURALISTS: SPRING 2026 MURAL COMMISSION","budget":"$27.500","deadline":"02/12/2026","applicationUrl":"mailto:director@artinpublicplaces.art","theme":"Open","description":"Dothan, Alabama'da b√ºy√ºk √∂l√ßekli bir kamusal sanat komisyonu i√ßin profesyonel bir muralist aranmaktadƒ±r. Ba≈üvurular 12 ≈ûubat 2026 tarihinde kapanacaktƒ±r.","wallDimensions":"1,100 square feet","dateAdded":"09.02.2026","status":"Pending"},{"id":1770616791908,"state":"Oakville, ON","competitionName":"Connextions 2026 Vinyl Window Murals @ Town of Oakville","budget":"$800 per artwork","deadline":"03/01/2026","applicationUrl":"https://ow.ly/8Bhz50Y6ucC","theme":"Connecting communities; belonging, shared spaces, local identity, arts, culture, nature. Photo-based artwork.","description":"Oakville Belediyesi, Connextions 2026 i√ßin profesyonel sanat√ßƒ±lardan fotoƒürafa dayalƒ± vinil pencere duvar resimleri i√ßin √ßaƒürƒ±da bulunuyor.","wallDimensions":"Large-scale vinyl murals on community centre windows","dateAdded":"09.02.2026","status":"Pending"},{"id":1770616791876,"state":"Cochrane, AB","competitionName":"Legacy Hall Mural Project Proposal","budget":"N/A","deadline":"02/20/2026","applicationUrl":"N/A","theme":"Land, History & Indigenous Culture","description":"Cochrane'daki Lions Club & Etkinlik Merkezi, Legacy Hall i√ßin geni≈ü √∂l√ßekli bir duvar resmi projesi i√ßin Yerli sanat√ßƒ±lardan ve deneyimli muralistlerden teklifler beklemektedir.","wallDimensions":"60x8 ft","dateAdded":"09.02.2026","status":"Pending"},{"id":1770616261007,"state":"Buffalo, NY","competitionName":"Call for Artists: The Essex Street Arts Center","budget":"$15,000","deadline":"02/20/2026","applicationUrl":"https://www.asiwny.org/2026/01/02/call-for-artists-essex-street-arts-center/","theme":"Transformation in Motion","description":"Arts Services Inc. of Western New York, Buffalo'daki Essex Arts Center'da b√ºy√ºk √∂l√ßekli bir dƒ±≈ü mekan murali i√ßin deneyimli sanat√ßƒ±larƒ± davet ediyor.","wallDimensions":"9 feet high x 96 feet wide","dateAdded":"09.02.2026","status":"Pending"},{"id":1770616180777,"state":"Bloomington, IN","competitionName":"Trades District Mural Call for Proposals","budget":"16,000","deadline":"02/25/2026","applicationUrl":"https://engagement.iu.edu/tradesdistrict/trades-mural-rfp.html","theme":"Trades District'ƒ±n end√ºstriyel k√∂klerini onurlandƒ±ran tema","description":"Indiana √úniversitesi ortaklƒ±ƒüƒ±yla, Bloomington'ƒ±n Trades B√∂lgesi'nde bir dƒ±≈ü mekan muralƒ± olu≈üturmak √ºzere bir topluluk sanat√ßƒ±sƒ± veya sanat√ßƒ± ekibi arƒ±yor.","wallDimensions":"N/A","dateAdded":"09.02.2026","status":"Pending"},{"id":1770615806762,"state":"Medford, Oregon","competitionName":"Bartlett-Middleford Mural Project","budget":"$10,000","deadline":"04/12/2026","applicationUrl":"https://www.medfordoregon.gov/files/assets/public/v/2/parks-recreation-and-facilities/documents/bid-docs/final-bartlett-middleford-mural-rfp.pdf","theme":"Connection","description":"Medford Public Arts Selection Committee, d√∂rt adet 4'x16' panelden olu≈üan bir kamusal duvar resmi projesi i√ßin teklif sunmaya davet ediyor.","wallDimensions":"4 adet 4'x16' panel (toplam 256 sq ft)","dateAdded":"09.02.2026","status":"Pending"},{"id":1770614479761,"state":"Steamboat Springs, CO","competitionName":"Colorado Mountain College ‚Äì Steamboat Springs Stairwell Mural Opportunity","budget":"$8,000","deadline":"02/20/2026","applicationUrl":"https://www.steamboatcreates.org/wp-content/uploads/2025/12/11_2025-CMC-stairwell-mural-RFP-sm-2.pdf","theme":"Joy in the Journey","description":"Colorado Mountain College'ƒ±n Steamboat Springs Kamp√ºs√º'ndeki bir merdiven bo≈üluƒüunu d√∂n√º≈üt√ºrmeyi ama√ßlayan bu mural yarƒ±≈ümasƒ±.","wallDimensions":"Yanlar: 324\"U x 76\"Y, √ñn: 103\"U x 76\"Y","dateAdded":"09.02.2026","status":"Pending"},{"id":1770614088368,"state":"Athens, GA","competitionName":"Call for Public Art: Morton Theatre","budget":"$20,000","deadline":"02/27/2026","applicationUrl":"https://www.accgov.com/11628/Call-for-Public-Art-Morton-Theatre","theme":"Morton Tiyatrosu'nun tarihini kutlamak","description":"Profesyonel sanat√ßƒ±lar, Morton Tiyatrosu lobisi i√ßin tiyatronun uzun tarihini kutlayan bir duvar resmi olu≈üturmak √ºzere davet ediliyor.","wallDimensions":"B√ºy√ºk i√ß duvar yakla≈üƒ±k 15ft x 8ft","dateAdded":"09.02.2026","status":"Pending"},{"id":1770613888329,"state":"Grand Rapids, MI","competitionName":"Awareness / Conciencia","budget":"$65,000","deadline":"02/28/2026","applicationUrl":"https://artist.callforentry.org/festivals_unique_info.php?ID=16828","theme":"Modern Latin Amerika sanatƒ±","description":"West Michigan Hispanic Ticaret Odasƒ±, modern Latin Amerika sanatƒ±ndan ilham alan duvar resimleri i√ßin sanat√ßƒ±larƒ± davet ediyor.","wallDimensions":"Duvar A: 15' G x 2 kat; Duvar B: 88 sq ft; Duvar C: 440 sq ft; Duvar D: 66 sq ft","dateAdded":"09.02.2026","status":"Pending","favorite":true},{"id":1770612472257,"state":"Longmont, CO","competitionName":"Downtown Longmont mural project","budget":"$85,000 USD","deadline":"02/27/2026","applicationUrl":"https://artist.callforentry.org/festivals_unique_info.php?ID=16229","theme":"Exciting, memorable, vibrant color palette","description":"Longmont, Colorado'daki Yaratƒ±cƒ± B√∂lge'nin kalbinde, 5.000 metrekarelik bir duvar resmi projesidir.","wallDimensions":"5,000 sq.ft.","dateAdded":"08.02.2026","status":"Pending"},{"id":1770609023986,"state":"Utah","competitionName":"2034 Olympic Winter Games Mural - Ogden City Public Art","budget":"$110,000","deadline":"03/20/2026","applicationUrl":"https://artist.callforentry.org/fair_plans/16965.pdf","theme":"Celebration of the 2034 Olympic Winter Games","description":"Ogden City Arts seeks an artist or team to design and install a mural celebrating the 2034 Olympic Winter Games.","dateAdded":"08.02.2026","status":"Pending","favorite":true},{"id":1770608512424,"state":"Montana","competitionName":"2026 Downtown Arts & Culture Impact Grant Application","budget":"N/A","deadline":"N/A","applicationUrl":"N/A","theme":"Open","description":"An application for the 2026 Downtown Arts & Culture Impact Grant is now open.","dateAdded":"08.02.2026","status":"Pending"},{"id":1770608512412,"state":"Montana","competitionName":"2026 Downtown Arts & Culture Impact Grants","budget":"$15,000 annually","deadline":"02/28/2026","applicationUrl":"https://www.missouladowntown.com/missoula-downtown-foundation/grants/","theme":"Placemaking projects","description":"The Missoula Downtown Foundation offers 2026 Arts & Culture Impact Grants.","dateAdded":"08.02.2026","status":"Pending"},{"id":1770608512362,"state":"MA","competitionName":"CALL FOR ART: North Common Shipping Container","budget":"$8.000","deadline":"02/17/2026","applicationUrl":"https://www.lowellma.gov/DocumentCenter/View/33857/North-Common-Call-For-Art-Info_PDF","theme":"Open","description":"Artists are invited to submit proposals for a mural on a shipping container.","dateAdded":"08.02.2026","status":"Pending"}];

        // State
        let geminiKey = localStorage.getItem('gemini_api_key') || 'AIzaSyBMKEFZseJOxxfxe0k3TN2tc7KyaLMlAv8';
        let storedOpportunities = localStorage.getItem('opportunities');
        let opportunities = storedOpportunities ? JSON.parse(storedOpportunities) : preloadedData;
        let currentFiles = [];

        // Initialize
        function init() {
            renderList();
            updateStats();
            if (geminiKey) apiKeyInput.value = geminiKey;
        }

        // Event Listeners
        if (addBtn) addBtn.addEventListener('click', () => openModal(uploadModal));
        if (settingsBtn) settingsBtn.addEventListener('click', () => openModal(settingsModal));

        // Paste Link functionality - inline input
        const pasteLinkInputArea = document.getElementById('paste-link-input-area');
        const pasteLinkInput = document.getElementById('paste-link-input');
        const pasteLinkAnalyze = document.getElementById('paste-link-analyze');
        const pasteLinkCancel = document.getElementById('paste-link-cancel');

        if (pasteLinkBtn) {
            pasteLinkBtn.addEventListener('click', () => {
                pasteLinkBtn.style.display = 'none';
                pasteLinkInputArea.style.display = 'flex';
                pasteLinkInput.focus();
            });
        }

        if (pasteLinkCancel) {
            pasteLinkCancel.addEventListener('click', () => {
                pasteLinkInputArea.style.display = 'none';
                pasteLinkBtn.style.display = 'inline-flex';
                pasteLinkInput.value = '';
            });
        }

        if (pasteLinkAnalyze) {
            pasteLinkAnalyze.addEventListener('click', async () => {
                const url = pasteLinkInput.value.trim();
                if (!url || !url.startsWith('http')) {
                    alert('Ge√ßerli bir URL girin');
                    return;
                }

                insightText.textContent = 'üîÑ Link analiz ediliyor...';
                pasteLinkAnalyze.disabled = true;
                pasteLinkAnalyze.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Analiz...';

                try {
                    const result = await analyzeUrlWithGemini(url);

                    // If null, the page had no valid competition info
                    if (result === null) {
                        insightText.textContent = '‚ö†Ô∏è Bu sayfada yarƒ±≈üma bilgisi bulunamadƒ±.';
                        pasteLinkInput.value = '';
                        pasteLinkInputArea.style.display = 'none';
                        pasteLinkBtn.style.display = 'inline-flex';
                        return;
                    }

                    addOpportunityWithDupeCheck(result);
                    insightText.textContent = `‚úÖ "${result.competitionName}" eklendi!`;
                    pasteLinkInput.value = '';
                    pasteLinkInputArea.style.display = 'none';
                    pasteLinkBtn.style.display = 'inline-flex';
                } catch (err) {
                    console.error('URL analysis failed:', err);
                    insightText.textContent = '‚ùå Analiz ba≈üarƒ±sƒ±z: ' + err.message;
                } finally {
                    pasteLinkAnalyze.disabled = false;
                    pasteLinkAnalyze.innerHTML = '<i class="fa-solid fa-search"></i> Analiz Et';
                }
            });
        }

        // Enter key to analyze
        if (pasteLinkInput) {
            pasteLinkInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') pasteLinkAnalyze.click();
                if (e.key === 'Escape') pasteLinkCancel.click();
            });
        }

        closeButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                closeModal(e.target.closest('.modal'));
            });
        });

        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                closeModal(e.target);
            }
        });

        saveApiKeyBtn.addEventListener('click', () => {
            const newKey = apiKeyInput.value.trim();
            if (newKey) {
                geminiKey = newKey;
                localStorage.setItem('gemini_api_key', geminiKey);
            }
            closeModal(settingsModal);
            alert('API Key kaydedildi!');
        });

        // File Upload Handling
        if (dropZone) {
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                if (e.dataTransfer.files.length) {
                    handleFilesSelect(Array.from(e.dataTransfer.files));
                }
            });
        }

        if (fileInput) {
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    handleFilesSelect(Array.from(e.target.files));
                }
            });
        }

        function handleFilesSelect(files) {
            // Allow more types supported by Gemini (Images, PDF, Video, Audio, Text)
            // But strict * might be too much, let's allow common ones.
            // User asked for "all media", so we will be permissive and let Gemini decide/fail if unsupported.
            const validFiles = files;

            if (validFiles.length === 0) {
                alert('Please upload files.');
                return;
            }

            currentFiles = validFiles;
            analyzeBtn.disabled = false;

            // Preview all files
            previewArea.innerHTML = validFiles.map((f, i) =>
                `<div style="display:inline-block;margin:4px;text-align:center;">
                    <div style="width:60px;height:60px;background:#e5e7eb;border-radius:6px;display:flex;align-items:center;justify-content:center;">
                        ${f.type.startsWith('image/')
                    ? `<img src="${URL.createObjectURL(f)}" style="width:100%;height:100%;object-fit:cover;border-radius:6px;">`
                    : `<i class="fa-solid fa-file" style="font-size:1.5rem;color:#6b7280;"></i>`
                }
                    </div>
                    <div style="font-size:0.7rem;max-width:60px;overflow:hidden;text-overflow:ellipsis;">${f.name}</div>
                </div>`
            ).join('');
            previewArea.classList.remove('hidden');
            analyzeBtn.innerHTML = `<i class="fa-solid fa-wand-magic-sparkles"></i> Analyze ${validFiles.length} File${validFiles.length > 1 ? 's' : ''}`;
        }

        // Analysis
        analyzeBtn.addEventListener('click', async () => {
            if (!geminiKey) {
                alert('Please set your Google Gemini API Key in settings first.');
                openModal(settingsModal);
                return;
            }

            if (currentFiles.length === 0) return;

            setLoading(true);

            try {
                // Analyze all files first
                const results = [];
                for (let i = 0; i < currentFiles.length; i++) {
                    try {
                        analyzeBtn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Analyzing ${i + 1}/${currentFiles.length}...`;
                        const result = await analyzeImageWithGemini(currentFiles[i]);
                        results.push(result);
                    } catch (err) {
                        console.error(`Failed: ${currentFiles[i].name}`, err);
                    }
                }

                // Merge duplicates by competition name (fuzzy matching)
                const merged = [];
                results.forEach(r => {
                    const newName = (r.competitionName || '').toLowerCase().trim();
                    if (!newName) return;

                    const existing = merged.find(m => similarity((m.competitionName || '').toLowerCase(), newName) > 0.7);

                    if (existing) {
                        // Merge: prefer non-empty values
                        if (r.state && r.state !== 'N/A') existing.state = r.state;
                        if (r.budget && r.budget !== 'N/A') existing.budget = r.budget;
                        if (r.deadline && r.deadline !== 'N/A') existing.deadline = r.deadline;
                        if (r.applicationUrl && r.applicationUrl !== 'N/A') existing.applicationUrl = r.applicationUrl;
                        if (r.theme && r.theme !== 'Open') existing.theme = r.theme;
                        if (r.description) existing.description = r.description;
                        if (r.wallDimensions && r.wallDimensions !== 'N/A') existing.wallDimensions = r.wallDimensions;
                    } else {
                        merged.push({ ...r });
                    }
                });

                // Add merged opportunities with duplicate check against existing list
                merged.forEach(opp => addOpportunityWithDupeCheck(opp));

                insightText.textContent = `${merged.length} fƒ±rsat eklendi (${results.length} dosya analiz edildi)`;
                closeModal(uploadModal);
                resetUpload();
            } catch (error) {
                console.error('Analysis failed:', error);
                alert('Analysis failed: ' + error.message);
            } finally {
                setLoading(false);
            }
        });

        async function analyzeImageWithGemini(file) {
            // REST API Endpoint - Using gemini-2.5-flash (confirmed working)
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${geminiKey}`;

            // Read file as base64
            const base64Data = await readFileAsBase64(file);

            const requestBody = {
                contents: [{
                    parts: [
                        {
                            text: `Analyze this mural competition document. Extract in JSON:
                            {
                                "state": "City, State (e.g. Austin, TX) or Region or 'N/A'",
                                "competitionName": "Full competition name",
                                "budget": "Budget amount or 'N/A'",
                                "deadline": "Deadline (MM/DD/YYYY) or 'N/A'",
                                "applicationUrl": "Application URL or 'N/A'",
                                "theme": "Art theme/style requirement or 'Open'",
                                "description": "1-2 c√ºmle T√ºrk√ße √∂zet",
                                "wallDimensions": "Wall dimensions/size (e.g. 10x20 ft) or 'N/A'"
                            }
                            Return ONLY raw JSON.`
                        },
                        {
                            inline_data: {
                                "mime_type": file.type,
                                "data": base64Data
                            }
                        }
                    ]
                }]
            };

            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                throw new Error(`API Error: ${response.statusText}`);
            }

            const data = await response.json();

            // Parse response
            if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts) {
                const text = data.candidates[0].content.parts[0].text;
                // Clean code blocks if present
                const jsonString = text.replace(/```json/g, '').replace(/```/g, '').trim();
                return JSON.parse(jsonString);
            } else {
                throw new Error('Invalid response structure from Gemini API');
            }
        }


        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // OpenAI URL Analysis
        async function analyzeUrlWithGemini(url) {
            // Use multiple strategies to fetch page content
            let textContent = '';
            let fetchSuccess = false;

            // Strategy 1: Jina Reader API (best for dynamic pages)
            try {
                const jinaResponse = await fetch(`https://r.jina.ai/${url}`, {
                    headers: { 'Accept': 'text/plain' }
                });
                if (jinaResponse.ok) {
                    textContent = await jinaResponse.text();
                    if (textContent && textContent.length > 200) {
                        fetchSuccess = true;
                    }
                }
            } catch (e) {
                console.warn('Jina Reader failed:', e);
            }

            // Strategy 2: CORS proxies as fallback
            if (!fetchSuccess) {
                const proxies = [
                    (u) => `https://api.allorigins.win/get?url=${encodeURIComponent(u)}`,
                    (u) => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(u)}`
                ];

                for (const proxy of proxies) {
                    try {
                        const proxyUrl = proxy(url);
                        const pageResponse = await fetch(proxyUrl);
                        if (!pageResponse.ok) continue;

                        let htmlContent = '';
                        if (proxyUrl.includes('allorigins')) {
                            const pageData = await pageResponse.json();
                            htmlContent = pageData.contents || '';
                        } else {
                            htmlContent = await pageResponse.text();
                        }

                        if (htmlContent && htmlContent.length > 500) {
                            // Extract text content (remove HTML tags)
                            textContent = htmlContent.replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '')
                                .replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '')
                                .replace(/<[^>]*>/g, ' ')
                                .replace(/\s+/g, ' ')
                                .trim();
                            if (textContent.length > 200) {
                                fetchSuccess = true;
                                break;
                            }
                        }
                    } catch (e) {
                        console.warn('Proxy failed:', e);
                    }
                }
            }

            // Truncate content for API
            textContent = textContent.substring(0, 20000);

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${geminiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: `Bu web sayfasƒ± i√ßeriƒüini analiz et ve mural/sanat yarƒ±≈ümasƒ± bilgilerini √ßƒ±kar.

URL: ${url}
ƒ∞√ßerik: ${textContent || 'Sayfa i√ßeriƒüi alƒ±namadƒ±'}

√ñNEMLƒ∞ KURALLAR:
1. Eƒüer bu sayfa bir mural/sanat yarƒ±≈ümasƒ± veya fƒ±rsat DEƒûƒ∞LSE, "skip": true d√∂nd√ºr
2. Eƒüer sayfa login gerektiriyor veya i√ßerik bo≈üsa, "skip": true d√∂nd√ºr  
3. Eƒüer yarƒ±≈üma adƒ±, b√ºt√ße veya deadline bilgisi YOKSA, "skip": true d√∂nd√ºr
4. Sadece ger√ßek yarƒ±≈üma bilgisi varsa a≈üaƒüƒ±daki JSON'u doldur

JSON formatƒ±nda d√∂nd√ºr (sadece raw JSON):
{
    "skip": false,
    "state": "≈ûehir, Eyalet (√∂rn: Austin, TX) veya 'N/A'",
    "competitionName": "Yarƒ±≈üma Adƒ±",
    "budget": "B√ºt√ße tutarƒ± veya 'N/A'",
    "deadline": "Son ba≈üvuru tarihi (MM/DD/YYYY) veya 'N/A'",
    "applicationUrl": "${url}",
    "theme": "Tema/Stil veya 'Open'",
    "description": "1-2 c√ºmle T√ºrk√ße √∂zet",
    "wallDimensions": "Duvar √∂l√ß√ºleri veya 'N/A'"
}`
                        }]
                    }],
                    generationConfig: { temperature: 0.2 }
                })
            });

            if (!response.ok) {
                const err = await response.json();
                throw new Error(err.error?.message || 'Gemini API error');
            }

            const data = await response.json();
            const content = data.candidates[0].content.parts[0].text;
            const jsonString = content.replace(/```json/g, '').replace(/```/g, '').trim();
            const result = JSON.parse(jsonString);

            // If Gemini says to skip, return null
            if (result.skip === true) {
                return null;
            }

            // Remove skip field from result
            delete result.skip;
            return result;
        }

        // Fuzzy string similarity
        function similarity(s1, s2) {
            const longer = s1.length > s2.length ? s1 : s2;
            const shorter = s1.length > s2.length ? s2 : s1;
            if (longer.length === 0) return 1.0;
            return (longer.length - editDistance(longer, shorter)) / longer.length;
        }

        function editDistance(s1, s2) {
            s1 = s1.toLowerCase(); s2 = s2.toLowerCase();
            const costs = [];
            for (let i = 0; i <= s1.length; i++) {
                let lastVal = i;
                for (let j = 0; j <= s2.length; j++) {
                    if (i === 0) costs[j] = j;
                    else if (j > 0) {
                        let newVal = costs[j - 1];
                        if (s1.charAt(i - 1) !== s2.charAt(j - 1))
                            newVal = Math.min(Math.min(newVal, lastVal), costs[j]) + 1;
                        costs[j - 1] = lastVal;
                        lastVal = newVal;
                    }
                }
                if (i > 0) costs[s2.length] = lastVal;
            }
            return costs[s2.length];
        }

        // Add with duplicate check
        function addOpportunityWithDupeCheck(data) {
            const newName = (data.competitionName || '').toLowerCase().trim();

            // Check for similar existing opportunities
            const duplicate = opportunities.find(opp => {
                const existingName = (opp.competitionName || '').toLowerCase().trim();
                return similarity(newName, existingName) > 0.7;
            });

            if (duplicate) {
                // Merge info into existing
                if (data.state && data.state !== 'N/A') duplicate.state = data.state;
                if (data.budget && data.budget !== 'N/A') duplicate.budget = data.budget;
                if (data.deadline && data.deadline !== 'N/A') duplicate.deadline = data.deadline;
                if (data.applicationUrl && data.applicationUrl !== 'N/A') duplicate.applicationUrl = data.applicationUrl;
                if (data.theme && data.theme !== 'Open') duplicate.theme = data.theme;
                if (data.description) duplicate.description = data.description;
                localStorage.setItem('opportunities', JSON.stringify(opportunities));
                renderList();
                updateStats();
                return duplicate;
            } else {
                return addOpportunity(data);
            }
        }

        // UI Rendering
        function addOpportunity(data) {
            const newOpportunity = {
                id: Date.now(),
                ...data,
                dateAdded: new Date().toLocaleDateString(),
                status: 'Pending'
            };

            opportunities.unshift(newOpportunity);
            localStorage.setItem('opportunities', JSON.stringify(opportunities));
            renderList();
            updateStats();

            insightText.textContent = `Latest analysis: ${data.name} by ${data.artist} - ${data.condition}`;
        }

        // View and Sort state
        let currentView = 'active'; // 'active' or 'archive'
        let currentSort = 'deadline';

        function setView(view) {
            currentView = view;
            const activeBtn = document.getElementById('tab-active');
            const archiveBtn = document.getElementById('tab-archive');

            if (view === 'active') {
                activeBtn.classList.add('active');
                archiveBtn.classList.remove('active');
            } else {
                activeBtn.classList.remove('active');
                archiveBtn.classList.add('active');
            }
            renderList();
        }

        function handleSort(sortBy) {
            currentSort = sortBy;
            renderList();
        }

        function renderList() {
            muralListBody.innerHTML = '';

            // Filter by view
            let filtered = opportunities.filter(opp => {
                const isArchived = opp.status === 'Applied' || opp.status === 'Missed' || opp.status === 'Won';
                return currentView === 'archive' ? isArchived : !isArchived;
            });

            if (filtered.length === 0) {
                emptyState.style.display = 'block';
                emptyState.innerHTML = currentView === 'archive'
                    ? '<p>üìÅ Ar≈üivde hen√ºz fƒ±rsat yok.</p>'
                    : '<p>No opportunities found. Click "+ Add Opportunity" to upload.</p>';
                return;
            }

            emptyState.style.display = 'none';

            // Sort based on currentSort
            const sorted = [...filtered].sort((a, b) => {
                if (currentSort === 'deadline') {
                    const dateA = a.deadline && a.deadline !== 'N/A' ? new Date(a.deadline) : null;
                    const dateB = b.deadline && b.deadline !== 'N/A' ? new Date(b.deadline) : null;
                    if (!dateA && !dateB) return 0;
                    if (!dateA) return 1;
                    if (!dateB) return -1;
                    return dateA - dateB;
                } else if (currentSort === 'budget') {
                    const budgetA = parseFloat((a.budget || '').replace(/[^0-9.]/g, '')) || 0;
                    const budgetB = parseFloat((b.budget || '').replace(/[^0-9.]/g, '')) || 0;
                    return budgetB - budgetA; // Higher first
                } else if (currentSort === 'name') {
                    return (a.competitionName || '').localeCompare(b.competitionName || '');
                }
                return 0;
            });

            sorted.forEach(opp => {
                const row = document.createElement('tr');
                const statusClass = opp.status === 'Won' ? 'status-won' : opp.status === 'Applied' ? 'status-applied' : opp.status === 'Missed' ? 'status-missed' : 'status-pending';
                const hasUrl = opp.applicationUrl && opp.applicationUrl !== 'Not specified' && opp.applicationUrl !== 'N/A';
                const thumbnailHtml = opp.thumbnail
                    ? `<img src="${opp.thumbnail}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 6px; cursor: pointer;" onclick="viewImage(${opp.id})">`
                    : `<div style="width: 50px; height: 50px; background: #e5e7eb; border-radius: 6px; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="addThumbnail(${opp.id})"><i class="fa-solid fa-plus" style="color: #9ca3af;"></i></div>`;

                // Calculate urgency
                let urgencyBadge = '';
                let rowClass = '';
                let dayName = '';

                if (opp.deadline && opp.deadline !== 'Not specified' && opp.deadline !== 'N/A') {
                    const deadlineDate = new Date(opp.deadline);
                    const today = new Date();
                    const daysUntil = Math.ceil((deadlineDate - today) / (1000 * 60 * 60 * 24));

                    // Get day name (Turkish)
                    try {
                        dayName = deadlineDate.toLocaleDateString('tr-TR', { weekday: 'long' });
                    } catch (e) {
                        dayName = '';
                    }

                    if (daysUntil < 0) {
                        urgencyBadge = `<span class="urgency-badge" style="background:#fee2e2;color:#991b1b;animation:none;">‚ùå Ge√ßti</span>`;
                    } else if (daysUntil <= 3) {
                        urgencyBadge = `<span class="urgency-badge urgent">üî• ${daysUntil} g√ºn!</span>`;
                        rowClass = 'row-urgent';
                    } else if (daysUntil <= 7) {
                        urgencyBadge = `<span class="urgency-badge urgent">‚ö° ${daysUntil} g√ºn</span>`;
                        rowClass = 'row-urgent';
                    } else if (daysUntil <= 14) {
                        urgencyBadge = `<span class="urgency-badge warning">‚ö†Ô∏è ${daysUntil} g√ºn</span>`;
                        rowClass = 'row-warning';
                    } else if (daysUntil <= 30) {
                        urgencyBadge = `<span class="urgency-badge safe">üìÖ ${daysUntil} g√ºn</span>`;
                    }
                }

                // Calculate budget tier for styling
                let budgetClass = '';
                let budgetAmount = 0;
                if (opp.budget && opp.budget !== 'N/A') {
                    budgetAmount = parseFloat(opp.budget.replace(/[^0-9]/g, '')) || 0;
                    if (budgetAmount >= 100000) {
                        budgetClass = 'budget-red';      // 100K+ kƒ±rmƒ±zƒ±
                    } else if (budgetAmount >= 50000) {
                        budgetClass = 'budget-green';    // 50K+ ye≈üil
                    } else if (budgetAmount >= 25000) {
                        budgetClass = 'budget-orange';   // 25K+ turuncu
                    } else if (budgetAmount >= 15000) {
                        budgetClass = 'budget-purple';   // 15K+ mor
                    } else {
                        budgetClass = 'budget-gray';     // 10K altƒ± koyu gri
                    }
                }

                // Add favorite class if favorited
                if (opp.favorite) {
                    rowClass += ' row-favorite';
                }

                row.className = rowClass;
                row.innerHTML = `
                    <td>${thumbnailHtml}</td>
                    <td style="font-weight: 500;">
                        ${opp.state || 'N/A'}
                    </td>
                    <td>
                        <div style="font-weight: 700; font-size: 1.1rem;">${opp.competitionName}</div>
                        ${opp.theme && opp.theme !== 'Open' ? `<span style="background:#e0e7ff;color:#4338ca;padding:2px 8px;border-radius:10px;font-size:0.7rem;font-weight:600;">üé® ${opp.theme}</span>` : ''}
                        <div style="font-size: 0.8rem; color: #666; margin-top: 4px;">${opp.description || ''}</div>
                        ${opp.wallDimensions && opp.wallDimensions !== 'N/A' ? `<div style="font-size: 0.75rem; color: #555; margin-top: 2px;">üìè (${opp.wallDimensions})</div>` : ''}
                    </td>
                    <td class="budget-cell ${budgetClass}" onclick="editBudget(${opp.id}, '${(opp.budget || '').replace(/'/g, "\\'")}', this)">
                        ${opp.budget || 'N/A'}
                    </td>
                    <td class="deadline-cell" onclick="editDate(${opp.id}, '${opp.deadline || ''}', this)" style="cursor: pointer;">
                        <div>${opp.deadline || 'N/A'}</div>
                        <div style="font-size: 0.75rem; color: #666; margin-top: 2px;">${dayName}</div>
                        ${urgencyBadge}
                    </td>
                    <td>
                        <div id="url-cell-${opp.id}" class="url-cell">
                            ${hasUrl
                        ? `<a href="${opp.applicationUrl}" target="_blank" style="color: #4f46e5; text-decoration: none;"><i class="fa-solid fa-external-link-alt"></i> Open</a>
                               <button class="btn-icon" style="margin-left: 4px;" onclick="showUrlEdit(${opp.id}, '${opp.applicationUrl}')"><i class="fa-solid fa-pen" style="font-size: 0.7rem;"></i></button>`
                        : `<button class="btn btn-secondary" style="padding: 4px 10px; font-size: 0.8rem;" onclick="showUrlEdit(${opp.id}, '')"><i class="fa-solid fa-link"></i> Link Ekle</button>`
                    }
                        </div>
                    </td>
                    <td>
                        <select class="status-select ${statusClass}" onchange="updateStatus(${opp.id}, this.value)">
                            <option value="Pending" ${opp.status === 'Pending' ? 'selected' : ''}>Pending</option>
                            <option value="Applied" ${opp.status === 'Applied' ? 'selected' : ''}>Applied</option>
                            <option value="Won" ${opp.status === 'Won' ? 'selected' : ''}>üèÜ Kazanƒ±ldƒ±</option>
                            <option value="Missed" ${opp.status === 'Missed' ? 'selected' : ''}>Missed</option>
                        </select>
                    </td>
                    <td>
                        <button class="favorite-btn ${opp.favorite ? 'active' : ''}" onclick="toggleFavorite(${opp.id})" title="Favori">
                            <i class="fa-${opp.favorite ? 'solid' : 'regular'} fa-heart"></i>
                        </button>
                        <button class="btn-icon" onclick="deleteOpportunity(${opp.id})" title="Delete"><i class="fa-solid fa-trash"></i></button>
                    </td>
                `;
                muralListBody.appendChild(row);
            });
        }

        function updateStats() {
            const applied = opportunities.filter(o => o.status === 'Applied').length;
            const missed = opportunities.filter(o => o.status === 'Missed').length;
            const upcoming = opportunities.filter(o => {
                if (!o.deadline || o.deadline === 'Not specified') return false;
                const deadlineDate = new Date(o.deadline);
                const today = new Date();
                const daysUntil = Math.ceil((deadlineDate - today) / (1000 * 60 * 60 * 24));
                return daysUntil > 0 && daysUntil <= 30;
            }).length;

            // Calculate total budget
            const totalBudget = opportunities.reduce((sum, opp) => {
                if (!opp.budget) return sum;
                // Strip everything except digits to handle thousands separators like dots or commas
                const cleanBudget = opp.budget.replace(/[^0-9]/g, '');
                const num = parseFloat(cleanBudget);
                return sum + (isNaN(num) ? 0 : num);
            }, 0);

            // Calculate total won prize
            const totalWon = opportunities.reduce((sum, opp) => {
                if (opp.status !== 'Won' || !opp.budget) return sum;
                const cleanBudget = opp.budget.replace(/[^0-9]/g, '');
                const num = parseFloat(cleanBudget);
                return sum + (isNaN(num) ? 0 : num);
            }, 0);

            document.getElementById('stat-total').textContent = opportunities.length;
            document.getElementById('stat-applied').textContent = applied;
            document.getElementById('stat-upcoming').textContent = upcoming;
            document.getElementById('stat-missed').textContent = missed;

            // Update Won Prize Display
            const wonDisplay = document.getElementById('won-prize-display');
            const wonAmount = document.getElementById('won-prize-amount');
            if (wonDisplay && wonAmount) {
                if (totalWon > 0) {
                    wonDisplay.style.display = 'inline-flex';
                    wonAmount.textContent = '$' + totalWon.toLocaleString();
                } else {
                    wonDisplay.style.display = 'none';
                }
            }

            // Animate budget with slot machine effect
            animateBudget(totalBudget);
        }

        // Slot machine budget animation
        let lastBudget = 0;
        function animateBudget(targetBudget) {
            const budgetEl = document.getElementById('stat-budget');
            if (!budgetEl) return;

            // If same value, no animation
            if (targetBudget === lastBudget) {
                budgetEl.textContent = '$' + targetBudget.toLocaleString();
                return;
            }

            const startBudget = lastBudget;
            lastBudget = targetBudget;
            const duration = 1500; // 1.5 seconds
            const startTime = performance.now();
            const isIncrease = targetBudget > startBudget;

            // Add spinning class
            budgetEl.classList.add('spinning');

            function animate(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                // Easing function for exciting effect
                const easeOut = 1 - Math.pow(1 - progress, 4);

                // Calculate current value with some random jitter for slot effect
                let currentVal = startBudget + (targetBudget - startBudget) * easeOut;

                // Add jitter in first 80% of animation
                if (progress < 0.8) {
                    currentVal += (Math.random() - 0.5) * (targetBudget - startBudget) * 0.1;
                }

                budgetEl.textContent = '$' + Math.round(Math.max(0, currentVal)).toLocaleString();

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    // Final value
                    budgetEl.textContent = '$' + targetBudget.toLocaleString();
                    budgetEl.classList.remove('spinning');

                    // Jackpot effect if budget increased
                    if (isIncrease && targetBudget > 0) {
                        budgetEl.classList.add('jackpot');
                        createSparkles(budgetEl);
                        setTimeout(() => budgetEl.classList.remove('jackpot'), 500);
                    }
                }
            }

            requestAnimationFrame(animate);
        }

        // Create sparkle effects
        function createSparkles(element) {
            const card = element.closest('.budget-card');
            if (!card) return;

            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.style.left = (20 + Math.random() * 60) + '%';
                    sparkle.style.top = (20 + Math.random() * 60) + '%';
                    card.appendChild(sparkle);
                    setTimeout(() => sparkle.remove(), 800);
                }, i * 50);
            }
        }

        // Edit Budget Function
        window.editBudget = function (id, currentBudget, cell) {
            if (cell.querySelector('input')) return; // Already editing

            // Stop propagation to prevent row click events if any
            if (window.event) window.event.stopPropagation();

            const originalContent = cell.innerHTML;
            // Extract number for editing
            const numericValue = currentBudget ? currentBudget.replace(/[^0-9.]/g, '') : '';

            const input = document.createElement('input');
            input.type = 'text';
            input.inputMode = 'decimal'; // Numeric keyboard on mobile
            input.value = numericValue;
            input.placeholder = '0';
            input.style.width = '80px';
            input.style.padding = '4px';
            input.style.borderRadius = '4px';
            input.style.border = '2px solid #10b981';
            input.style.outline = 'none';
            input.style.fontWeight = 'bold';
            input.style.color = '#10b981';

            // Function to save
            const save = () => {
                let newValue = input.value.trim();

                // Format with $ and commas if it's a number
                if (newValue && !isNaN(newValue.replace(/,/g, ''))) {
                    const num = parseFloat(newValue.replace(/,/g, ''));
                    newValue = '$' + num.toLocaleString();
                } else if (!newValue) {
                    newValue = 'N/A';
                }

                // Update logic
                const opp = opportunities.find(o => o.id === id);
                if (opp) {
                    opp.budget = newValue;
                    localStorage.setItem('opportunities', JSON.stringify(opportunities));
                    updateStats(); // Trigger animations
                    renderList(); // Re-render to update view
                } else {
                    cell.innerHTML = originalContent;
                }
            };

            // Cancel
            const cancel = () => {
                cell.innerHTML = originalContent;
            };

            input.onclick = (e) => e.stopPropagation(); // Prevent bubbling inside input
            input.onblur = save;
            input.onkeydown = (e) => {
                if (e.key === 'Enter') {
                    input.blur(); // Triggers save
                }
                if (e.key === 'Escape') cancel();
            };

            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
        }

        // Edit Date Function
        window.editDate = function (id, currentDeadline, cell) {
            if (cell.querySelector('input')) return; // Already editing

            // Stop propagation
            if (window.event) window.event.stopPropagation();

            const originalContent = cell.innerHTML;

            // Convert MM/DD/YYYY to YYYY-MM-DD for input
            let inputValue = '';
            if (currentDeadline && currentDeadline !== 'N/A' && currentDeadline !== 'Not specified') {
                const parts = currentDeadline.split('/');
                if (parts.length === 3) {
                    inputValue = `${parts[2]}-${parts[0].padStart(2, '0')}-${parts[1].padStart(2, '0')}`;
                }
            }

            const input = document.createElement('input');
            input.type = 'date';
            input.value = inputValue;
            input.style.padding = '4px';
            input.style.borderRadius = '4px';
            input.style.border = '2px solid #4f46e5';
            input.style.outline = 'none';
            input.style.color = '#4f46e5';
            input.style.fontWeight = '500';

            // Save function
            const save = () => {
                const newValue = input.value;
                let formattedDate = 'N/A';

                if (newValue) {
                    const [year, month, day] = newValue.split('-');
                    // Convert back to MM/DD/YYYY
                    formattedDate = `${parseInt(month)}/${parseInt(day)}/${year}`;
                } else {
                    // Start editing cancelled or cleared?
                    // actually if cleared, let's keep N/A or revert?
                    // If user clears date, set N/A
                    formattedDate = 'N/A';
                }

                // Update logic
                const opp = opportunities.find(o => o.id === id);
                if (opp) {
                    opp.deadline = formattedDate;
                    localStorage.setItem('opportunities', JSON.stringify(opportunities));
                    updateStats(); // Update urgency badges
                    renderList(); // Re-render to update view
                } else {
                    cell.innerHTML = originalContent;
                }
            };

            const cancel = () => {
                cell.innerHTML = originalContent;
            };

            input.onclick = (e) => e.stopPropagation();
            input.onblur = save;
            input.onkeydown = (e) => {
                if (e.key === 'Enter') input.blur();
                if (e.key === 'Escape') cancel();
            };

            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();

            // Try to open picker
            try {
                if (typeof input.showPicker === 'function') {
                    input.showPicker();
                }
            } catch (e) {
                console.log('Auto-picker not supported on this browser interaction');
            }
        }

        // Status update function
        window.updateStatus = function (id, newStatus) {
            const opp = opportunities.find(o => o.id === id);
            if (opp) {
                opp.status = newStatus;
                localStorage.setItem('opportunities', JSON.stringify(opportunities));
                renderList();
                updateStats();
            }
        }

        // Toggle favorite function
        window.toggleFavorite = function (id) {
            const opp = opportunities.find(o => o.id === id);
            if (opp) {
                opp.favorite = !opp.favorite;
                localStorage.setItem('opportunities', JSON.stringify(opportunities));
                renderList();
            }
        }

        // Delete function - direct without confirmation
        window.deleteOpportunity = function (id) {
            opportunities = opportunities.filter(o => o.id !== id);
            localStorage.setItem('opportunities', JSON.stringify(opportunities));
            renderList();
            updateStats();
        }

        // URL update function
        window.updateUrl = function (id, newUrl) {
            const opp = opportunities.find(o => o.id === id);
            if (opp) {
                opp.applicationUrl = newUrl;
                localStorage.setItem('opportunities', JSON.stringify(opportunities));
                renderList();
            }
        }

        // Show inline URL edit input
        window.showUrlEdit = function (id, currentUrl) {
            const cell = document.getElementById(`url-cell-${id}`);
            if (cell) {
                cell.innerHTML = `
                    <div style="display: flex; gap: 4px; align-items: center;">
                        <input type="text" id="url-input-${id}" value="${currentUrl || ''}" placeholder="URL yapƒ±≈ütƒ±r..." 
                            style="width: 120px; padding: 6px 10px; border: 2px solid #4f46e5; border-radius: 6px; font-size: 0.85rem; outline: none;"
                            onkeydown="if(event.key==='Enter') saveUrlEdit(${id}); if(event.key==='Escape') renderList();">
                        <button onclick="saveUrlEdit(${id})" style="background: #10b981; color: white; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; font-size: 0.8rem;">
                            <i class="fa-solid fa-check"></i>
                        </button>
                        <button onclick="renderList()" style="background: #ef4444; color: white; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; font-size: 0.8rem;">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>
                `;
                document.getElementById(`url-input-${id}`).focus();
            }
        }

        // Save URL from inline edit
        window.saveUrlEdit = function (id) {
            const input = document.getElementById(`url-input-${id}`);
            if (input) {
                const opp = opportunities.find(o => o.id === id);
                if (opp) {
                    opp.applicationUrl = input.value.trim() || 'N/A';
                    localStorage.setItem('opportunities', JSON.stringify(opportunities));
                    renderList();
                }
            }
        }

        // Add thumbnail function with compression
        window.addThumbnail = function (id) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    try {
                        // Compress image to reduce localStorage size
                        const compressedBase64 = await compressImage(file, 200, 200, 0.7);
                        const opp = opportunities.find(o => o.id === id);
                        if (opp) {
                            opp.thumbnail = compressedBase64;
                            localStorage.setItem('opportunities', JSON.stringify(opportunities));
                            renderList();
                        }
                    } catch (err) {
                        console.error('Image compression failed:', err);
                        alert('Resim eklenirken hata olu≈ütu: ' + err.message);
                    }
                }
            };
            input.click();
        }

        // Compress image helper function
        function compressImage(file, maxWidth, maxHeight, quality) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;

                    // Calculate new dimensions
                    if (width > height) {
                        if (width > maxWidth) {
                            height = Math.round((height * maxWidth) / width);
                            width = maxWidth;
                        }
                    } else {
                        if (height > maxHeight) {
                            width = Math.round((width * maxHeight) / height);
                            height = maxHeight;
                        }
                    }

                    canvas.width = width;
                    canvas.height = height;

                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);

                    // Convert to compressed base64
                    const compressedBase64 = canvas.toDataURL('image/jpeg', quality);
                    resolve(compressedBase64);
                };
                img.onerror = reject;
                img.src = URL.createObjectURL(file);
            });
        }

        // View image function
        window.viewImage = function (id) {
            const opp = opportunities.find(o => o.id === id);
            if (opp && opp.thumbnail) {
                const win = window.open();
                win.document.write(`<img src="${opp.thumbnail}" style="max-width: 100%; max-height: 100%;">`);
            }
        }

        // Helpers
        function openModal(modal) {
            modal.classList.remove('hidden');
        }

        function closeModal(modal) {
            modal.classList.add('hidden');
        }

        function resetUpload() {
            currentFiles = [];
            fileInput.value = '';
            previewArea.innerHTML = '';
            previewArea.classList.add('hidden');
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<i class="fa-solid fa-wand-magic-sparkles"></i> Analyze with Gemini';
        }

        function setLoading(isLoading) {
            if (isLoading) {
                analyzeBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Analyzing...';
                analyzeBtn.disabled = true;
            } else {
                analyzeBtn.innerHTML = '<i class="fa-solid fa-wand-magic-sparkles"></i> Analyze with Gemini';
                analyzeBtn.disabled = false;
            }
        }

        // Init
        init();
    </script>
</body>

</html>
